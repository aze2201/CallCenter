(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{260:function(t,e,a){var n=a(283);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("fcfb9244",n,!0,{})},270:function(t,e,a){"use strict";a.d(e,"a",function(){return i});var n=a(321),s=a.n(n),o=a(322),r=a.n(o),i=function(t){var e=s()(t),a=r.a.hex.hsl(e),n=[40*Math.round(a[0]/40),a[1],a[2]];return"#"+r.a.hsl.hex(n)}},282:function(t,e,a){"use strict";var n=a(260);a.n(n).a},283:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\np.avatar-settings span.icon-loading-small[data-v-768f6630] {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tpadding: 5px 0;\n}\n",""])},292:function(e,a,n){"use strict";n(281);var s=n(317),o=n.n(s),r=n(318),i=n.n(r),c=n(319),l=n.n(c),d=n(320),u=n.n(d),m=(n(136),n(262)),p=n.n(m),h=n(270),f=n(19),g={name:"NavigationAccount",components:{AppNavigationItem:p.a},props:{account:{type:Object,required:!0}},data:function(){return{menuOpen:!1}},computed:{visible:function(){return!0!==this.account.isUnified&&!1!==this.account.visible},data:function(){var e=this,a={name:"accountSettings",params:{accountId:this.account.id}},n=this.account.error;return{id:"account"+this.account.id,key:"account"+this.account.id,text:this.account.emailAddress,bullet:n?void 0:Object(h.a)(this.account.name),icon:n?"icon-error":void 0,router:a,utils:{actions:[{icon:"icon-settings",text:t("mail","Edit"),action:function(){e.$router.push(a)}},{icon:"icon-delete",text:t("mail","Delete"),action:function(){e.$store.dispatch("deleteAccount",e.account).catch(function(t){return f.a.error("could not delete account",{error:t})})}},{icon:"icon-add",text:t("mail","Add folder"),input:"text",action:function(t){e.createFolder(t)}}]}}}},methods:{createFolder:function(t){var e=t.target.elements[0].value;f.a.info("creating folder "+e),this.menuOpen=!1,this.$store.dispatch("createFolder",{account:this.account,name:e}).then(function(){return f.a.info("folder ".concat(e," created"))}).catch(function(t){throw f.a.error("could not create folder",{error:t}),t})}}},v=n(70),b=Object(v.a)(g,function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.visible?a("AppNavigationItem",{attrs:{item:t.data,"menu-open":t.menuOpen},on:{"update:menuOpen":function(e){t.menuOpen=e},"update:menu-open":function(e){t.menuOpen=e}}}):t._e()},[],!1,null,null,null).exports,y={name:"NavigationAccount",components:{AppNavigationItem:p.a},props:{account:{type:Object,required:!0}},computed:{data:function(){var e=this;return{id:"collapse-"+this.account.id,key:"collapse-"+this.account.id,classes:["collapse-folders"],text:this.account.collapsed?t("mail","Show all folders"):t("mail","Collapse folders"),action:function(){return e.$store.commit("toggleAccountCollapsed",e.account.id)}}}}},x=Object(v.a)(y,function(){var t=this.$createElement;return(this._self._c||t)("AppNavigationItem",{attrs:{item:this.data}})},[],!1,null,null,null).exports,j=n(42),_=(n(323),n(324),n(8)),w=function(t){if(t.specialUse.length>0)try{return function(t){if(t.specialUse.includes("all"))return Object(_.translate)("mail","All");if(t.specialUse.includes("archive"))return Object(_.translate)("mail","Archive");if(t.specialUse.includes("drafts"))return Object(_.translate)("mail","Drafts");if(t.specialUse.includes("flagged"))return Object(_.translate)("mail","Favorites");if(t.specialUse.includes("inbox"))return Object(_.translate)("mail","Inbox");if(t.specialUse.includes("junk"))return Object(_.translate)("mail","Junk");if(t.specialUse.includes("sent"))return Object(_.translate)("mail","Sent");if(t.specialUse.includes("trash"))return Object(_.translate)("mail","Trash");throw new Error("unknown special use ".concat(t.specialUse))}(t)}catch(e){return console.error(e),atob(t.id)}return atob(t.id)},C={name:"NavigationFolder",components:{AppNavigationItem:p.a},props:{account:{type:Object,required:!0},folder:{type:Object,required:!0}},data:function(){return{menuOpen:!1,loadingFolderStats:!0,folderStats:void 0}},computed:{data:function(){return this.folderToEntry(this.folder,!0)}},watch:{menuOpen:function(){this.menuOpen&&this.fetchFolderStats()}},methods:{folderToEntry:function(e,a){var n=this,s="folder";e.specialRole&&(s=e.specialRole);var o=[];return a&&(this.loadingFolderStats?o.push({icon:"icon-info",text:atob(this.folder.id),longtext:t("mail","Loading …")}):o.push({icon:"icon-info",text:atob(this.folder.id),longtext:t("mail","{total} messages ({unread} unread)",{total:this.folderStats.total,unread:this.folderStats.unread})})),a&&(o.push({icon:"icon-checkmark",text:t("mail","Mark all as read"),longtext:t("mail","Mark all messages of this folder as read"),action:this.markAsRead(e)}),o.push({icon:"icon-add",text:t("mail","Add subfolder"),input:"text",action:this.createFolder})),{id:"account"+this.account.id+"_"+e.id,key:"account"+this.account.id+"_"+e.id,text:w(e),icon:"icon-"+s,router:{name:"folder",params:{accountId:this.account.id,folderId:e.id},exact:!1},utils:{actions:o,counter:e.unread},collapsible:!0,opened:e.opened,children:this.$store.getters.getSubfolders(this.account.id,e.id).map(function(t){return n.folderToEntry(t,!1)})}},fetchFolderStats:function(){var t=this;this.loadingFolderStats=!0,Object(j.c)(this.account.id,this.folder.id).then(function(e){f.a.debug("loaded folder stats",{stats:e}),t.folderStats=e,t.loadingFolderStats=!1}).catch(function(e){return f.a.error("could not load folder states for ".concat(t.folder.id),{error:e})})},createFolder:function(t){var e=t.target.elements[0].value,a=atob(this.folder.id)+this.folder.delimiter+e;f.a.info("creating folder ".concat(a," as subfolder of ").concat(this.folder.id)),this.menuOpen=!1,this.$store.dispatch("createFolder",{account:this.account,name:a}).then(function(){return f.a.info("folder ".concat(a," created"))}).catch(function(t){throw f.a.error("could not create folder ".concat(a),{error:t}),t})},markAsRead:function(t){var e=this;return function(){e.menuOpen=!1,e.$store.dispatch("markFolderRead",{account:e.account,folderId:t.id}).then(function(){return f.a.info("folder ".concat(t.id," marked as read"))}).catch(function(e){return f.a.error("could not mark folder ".concat(t.id," as read"),{error:e})})}}}},A=Object(v.a)(C,function(){var t=this,e=t.$createElement;return(t._self._c||e)("AppNavigationItem",{attrs:{item:t.data,"menu-open":t.menuOpen},on:{"update:menuOpen":function(e){t.menuOpen=e},"update:menu-open":function(e){t.menuOpen=e}}})},[],!1,null,null,null).exports,k={name:"AppSettingsMenu",data:function(){return{loadingAvatarSettings:!1}},computed:{useExternalAvatars:function(){return"true"===this.$store.getters.getPreference("external-avatars","true")}},methods:{onToggleExternalAvatars:function(t){var e=this;this.loadingAvatarSettings=!0,this.$store.dispatch("savePreference",{key:"external-avatars",value:t.target.checked?"true":"false"}).catch(function(t){return f.a.error("could not save preferences",{error:t})}).then(function(){e.loadingAvatarSettings=!1})}}},I=(n(282),Object(v.a)(k,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("router-link",{staticClass:"button new-button",attrs:{to:"/setup"}},[t._v(t._s(t.t("mail","Add mail account"))+" ")]),t._v(" "),t.loadingAvatarSettings?a("p",{staticClass:"avatar-settings"},[a("span",{staticClass:"icon-loading-small"}),t._v("\n\t\t"+t._s(t.t("mail","Use Gravatar and favicon avatars"))+"\n\t")]):a("p",[a("input",{staticClass:"checkbox",attrs:{id:"gravatar-enabled",type:"checkbox"},domProps:{checked:t.useExternalAvatars},on:{change:t.onToggleExternalAvatars}}),t._v(" "),a("label",{attrs:{for:"gravatar-enabled"}},[t._v(t._s(t.t("mail","Use Gravatar and favicon avatars")))])]),t._v(" "),a("p",{staticClass:"app-settings-hint"},[a("router-link",{attrs:{to:{name:"keyboardShortcuts"}}},[t._v("\n\t\t\t"+t._s(t.t("mail","Keyboard shortcuts"))+"\n\t\t")])],1),t._v(" "),a("p",{staticClass:"app-settings-hint"},[a("a",{attrs:{href:"https://www.mailvelope.com/",target:"_blank"}},[t._v(t._s(t.t("mail","Looking for a way to encrypt your emails? Install the Mailvelope browser extension!")))])])],1)},[],!1,null,"768f6630",null).exports),S=Object.seal(["inbox","flagged","drafts","sent"]),M={name:"Navigation",components:{AppNavigation:o.a,AppNavigationNew:i.a,AppNavigationSettings:l.a,AppNavigationSpacer:u.a,AppSettingsMenu:I,NavigationAccount:b,NavigationAccountExpandCollapse:x,NavigationFolder:A},data:function(){return{SHOW_COLLAPSED:S}},computed:{menu:function(){var t=this;return this.$store.getters.getAccounts().map(function(e){var a=t.$store.getters.getFolders(e.id).filter(function(t){return!e.collapsed||-1!==S.indexOf(t.specialRole)});return{id:e.id,account:e,folders:a}})}},methods:{onNewMessage:function(){this.$router.push({name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:"new"}})}}},$=Object(v.a)(M,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppNavigation",[a("AppNavigationNew",{attrs:{text:t.t("mail","New message"),"button-id":"mail_new_message","button-class":"icon-add"},on:{click:t.onNewMessage}}),t._v(" "),a("ul",{attrs:{id:"accounts-list"}},[t._l(t.menu,function(e){return[e.account?a("NavigationAccount",{key:e.account.id,attrs:{account:e.account}}):t._e(),t._v(" "),t._l(e.folders,function(n){return a("NavigationFolder",{directives:[{name:"show",rawName:"v-show",value:!e.account.collapsed||-1!==t.SHOW_COLLAPSED.indexOf(n.specialRole),expression:"!group.account.collapsed || SHOW_COLLAPSED.indexOf(item.specialRole) !== -1"}],key:n.key,attrs:{account:e.account,folder:n}})}),t._v(" "),!e.account.isUnified&&e.account.folders.length>0?a("NavigationAccountExpandCollapse",{key:"collapse-"+e.account.id,attrs:{account:e.account}}):t._e(),t._v(" "),a("AppNavigationSpacer",{key:"spacer-"+e.account.id})]})],2),t._v(" "),a("AppNavigationSettings",{attrs:{title:t.t("mail","Settings")}},[a("AppSettingsMenu")],1)],1)},[],!1,null,"783b9159",null);a.a=$.exports},327:function(t,e,a){var n=a(565);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("009e5834",n,!0,{})},335:function(t,e,a){var n=a(636);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("8ff7896e",n,!0,{})},336:function(t,e,a){var n=a(640);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("2f6b8e6e",n,!0,{})},340:function(t,e,a){var n=a(686);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("b3b9be8a",n,!0,{})},341:function(t,e,a){var n=a(688);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("3ef8a43a",n,!0,{})},342:function(t,e,a){var n=a(690);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("25fe426c",n,!0,{})},354:function(t,e,a){var n=a(778);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("9c7a1f4c",n,!0,{})},355:function(t,e,a){var n=a(780);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("382ff971",n,!0,{})},360:function(t,e,a){var n=a(815);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("15450fa7",n,!0,{})},361:function(t,e,a){var n=a(817);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("0d2c63ea",n,!0,{})},362:function(t,e,a){var n=a(819);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("de3e3f3e",n,!0,{})},363:function(t,e,a){var n=a(821);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(258).default)("b06c7bb2",n,!0,{})},564:function(t,e,a){"use strict";var n=a(327);a.n(n).a},565:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.toggle[data-v-a9d24ca6] {\n\tposition: fixed;\n\tdisplay: inline-block;\n\tleft: 0;\n\twidth: 44px;\n\theight: 44px;\n\tz-index: 149;\n\tbackground-color: var(--color-main-background-darker);\n\tcursor: pointer;\n\topacity: 0.6;\n\ttransform: rotate(180deg);\n\tmargin-top: 44px; /* under the show navigation button */\n}\n",""])},633:function(t,e,a){var n={"./af":383,"./af.js":383,"./ar":384,"./ar-dz":385,"./ar-dz.js":385,"./ar-kw":386,"./ar-kw.js":386,"./ar-ly":387,"./ar-ly.js":387,"./ar-ma":388,"./ar-ma.js":388,"./ar-sa":389,"./ar-sa.js":389,"./ar-tn":390,"./ar-tn.js":390,"./ar.js":384,"./az":391,"./az.js":391,"./be":392,"./be.js":392,"./bg":393,"./bg.js":393,"./bm":394,"./bm.js":394,"./bn":395,"./bn.js":395,"./bo":396,"./bo.js":396,"./br":397,"./br.js":397,"./bs":398,"./bs.js":398,"./ca":399,"./ca.js":399,"./cs":400,"./cs.js":400,"./cv":401,"./cv.js":401,"./cy":402,"./cy.js":402,"./da":403,"./da.js":403,"./de":404,"./de-at":405,"./de-at.js":405,"./de-ch":406,"./de-ch.js":406,"./de.js":404,"./dv":407,"./dv.js":407,"./el":408,"./el.js":408,"./en-SG":409,"./en-SG.js":409,"./en-au":410,"./en-au.js":410,"./en-ca":411,"./en-ca.js":411,"./en-gb":412,"./en-gb.js":412,"./en-ie":413,"./en-ie.js":413,"./en-il":414,"./en-il.js":414,"./en-nz":415,"./en-nz.js":415,"./eo":416,"./eo.js":416,"./es":417,"./es-do":418,"./es-do.js":418,"./es-us":419,"./es-us.js":419,"./es.js":417,"./et":420,"./et.js":420,"./eu":421,"./eu.js":421,"./fa":422,"./fa.js":422,"./fi":423,"./fi.js":423,"./fo":424,"./fo.js":424,"./fr":425,"./fr-ca":426,"./fr-ca.js":426,"./fr-ch":427,"./fr-ch.js":427,"./fr.js":425,"./fy":428,"./fy.js":428,"./ga":429,"./ga.js":429,"./gd":430,"./gd.js":430,"./gl":431,"./gl.js":431,"./gom-latn":432,"./gom-latn.js":432,"./gu":433,"./gu.js":433,"./he":434,"./he.js":434,"./hi":435,"./hi.js":435,"./hr":436,"./hr.js":436,"./hu":437,"./hu.js":437,"./hy-am":438,"./hy-am.js":438,"./id":439,"./id.js":439,"./is":440,"./is.js":440,"./it":441,"./it-ch":442,"./it-ch.js":442,"./it.js":441,"./ja":443,"./ja.js":443,"./jv":444,"./jv.js":444,"./ka":445,"./ka.js":445,"./kk":446,"./kk.js":446,"./km":447,"./km.js":447,"./kn":448,"./kn.js":448,"./ko":449,"./ko.js":449,"./ku":450,"./ku.js":450,"./ky":451,"./ky.js":451,"./lb":452,"./lb.js":452,"./lo":453,"./lo.js":453,"./lt":454,"./lt.js":454,"./lv":455,"./lv.js":455,"./me":456,"./me.js":456,"./mi":457,"./mi.js":457,"./mk":458,"./mk.js":458,"./ml":459,"./ml.js":459,"./mn":460,"./mn.js":460,"./mr":461,"./mr.js":461,"./ms":462,"./ms-my":463,"./ms-my.js":463,"./ms.js":462,"./mt":464,"./mt.js":464,"./my":465,"./my.js":465,"./nb":466,"./nb.js":466,"./ne":467,"./ne.js":467,"./nl":468,"./nl-be":469,"./nl-be.js":469,"./nl.js":468,"./nn":470,"./nn.js":470,"./pa-in":471,"./pa-in.js":471,"./pl":472,"./pl.js":472,"./pt":473,"./pt-br":474,"./pt-br.js":474,"./pt.js":473,"./ro":475,"./ro.js":475,"./ru":476,"./ru.js":476,"./sd":477,"./sd.js":477,"./se":478,"./se.js":478,"./si":479,"./si.js":479,"./sk":480,"./sk.js":480,"./sl":481,"./sl.js":481,"./sq":482,"./sq.js":482,"./sr":483,"./sr-cyrl":484,"./sr-cyrl.js":484,"./sr.js":483,"./ss":485,"./ss.js":485,"./sv":486,"./sv.js":486,"./sw":487,"./sw.js":487,"./ta":488,"./ta.js":488,"./te":489,"./te.js":489,"./tet":490,"./tet.js":490,"./tg":491,"./tg.js":491,"./th":492,"./th.js":492,"./tl-ph":493,"./tl-ph.js":493,"./tlh":494,"./tlh.js":494,"./tr":495,"./tr.js":495,"./tzl":496,"./tzl.js":496,"./tzm":497,"./tzm-latn":498,"./tzm-latn.js":498,"./tzm.js":497,"./ug-cn":499,"./ug-cn.js":499,"./uk":500,"./uk.js":500,"./ur":501,"./ur.js":501,"./uz":502,"./uz-latn":503,"./uz-latn.js":503,"./uz.js":502,"./vi":504,"./vi.js":504,"./x-pseudo":505,"./x-pseudo.js":505,"./yo":506,"./yo.js":506,"./zh-cn":507,"./zh-cn.js":507,"./zh-hk":508,"./zh-hk.js":508,"./zh-tw":509,"./zh-tw.js":509};function s(t){var e=o(t);return a(e)}function o(t){if(!a.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}s.keys=function(){return Object.keys(n)},s.resolve=o,t.exports=s,s.id=633},635:function(t,e,a){"use strict";var n=a(335);a.n(n).a},636:function(t,e,a){e=t.exports=a(257)(!1);var n=a(637)(a(638));e.push([t.i,"\n.mail-message-account-color[data-v-30996fff] {\n\tposition: absolute;\n\tleft: 0px;\n\twidth: 2px;\n\theight: 69px;\n\tz-index: 1;\n}\n.app-content-list-item.unseen[data-v-30996fff] {\n\tfont-weight: bold;\n}\n.app-content-list-item.draft .app-content-list-item-line-two[data-v-30996fff] {\n\tfont-style: italic;\n}\n.icon-reply[data-v-30996fff],\n.icon-attachment[data-v-30996fff] {\n\tdisplay: inline-block;\n\tvertical-align: text-top;\n}\n.icon-reply[data-v-30996fff] {\n\tbackground-image: url("+n+");\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=50)';\n\topacity: 0.5;\n}\n.icon-attachment[data-v-30996fff] {\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=25)';\n\topacity: 0.25;\n}\n",""])},638:function(t,e){t.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPGcgb3BhY2l0eT0iLjUiIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDE2LC0xMDM2LjQpIj4KICA8cGF0aCBkPSJtMSAxMDUxLjRzMC4zOTE0Ny03LjgwMjUgNy0xMHYtNGw3IDctNyA3di00Yy01LjExNTcgMC03IDQtNyA0eiIvPgogPC9nPgo8L3N2Zz4K"},639:function(t,e,a){"use strict";var n=a(336);a.n(n).a},640:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n#load-more-mail-messages[data-v-0bf2f7be] {\n\tmargin: 10px auto;\n\tpadding: 10px;\n\tmargin-top: 50px;\n\tmargin-bottom: 200px;\n}\n\n/* TODO: put this in core icons.css as general rule for buttons with icons */\n#load-more-mail-messages.icon-loading-small[data-v-0bf2f7be] {\n\tpadding-left: 32px;\n\tbackground-position: 9px center;\n}\n#list-refreshing[data-v-0bf2f7be] {\n\toverflow-y: hidden;\n\tmin-height: 0;\n\n\ttransition-property: all;\n\ttransition-duration: 0.5s;\n\ttransition-timing-function: ease-in;\n}\n#list-refreshing.refreshing[data-v-0bf2f7be] {\n\tmin-height: 32px;\n}\n.list-enter-active[data-v-0bf2f7be],\n.list-leave-active[data-v-0bf2f7be] {\n\ttransition: all 1s;\n}\n.list-enter[data-v-0bf2f7be],\n.list-leave-to[data-v-0bf2f7be] {\n\topacity: 0;\n\theight: 0px;\n\ttransform: scaleY(0);\n}\n",""])},685:function(t,e,a){"use strict";var n=a(340);a.n(n).a},686:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\nbutton[data-v-40de8a78] {\n\t/* TODO: remove for Nextcloud 15+ */\n\t/* https://github.com/nextcloud/server/pull/12138 */\n\tdisplay: inline-block;\n}\n.new-message-attachments li[data-v-40de8a78] {\n\tpadding: 10px;\n}\n.new-message-attachments-action[data-v-40de8a78] {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tpadding: 22px;\n\topacity: 0.5;\n}\n\n/* attachment filenames */\n.new-message-attachment-name[data-v-40de8a78] {\n\tdisplay: inline-block;\n}\n\n/* Colour the filename with a different color during attachment upload */\n.new-message-attachment-name.upload-ongoing[data-v-40de8a78] {\n\tcolor: #0082c9;\n}\n\n/* Colour the filename in red if the attachment upload failed */\n.new-message-attachment-name.upload-warning[data-v-40de8a78] {\n\tcolor: #d2322d;\n}\n\n/* Red ProgressBar for failed attachment uploads */\n.new-message-attachment-name.upload-warning .ui-progressbar-value[data-v-40de8a78] {\n\tborder: 1px solid #e9322d;\n\tbackground: #e9322d;\n}\n",""])},687:function(t,e,a){"use strict";var n=a(341);a.n(n).a},688:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.message-composer[data-v-587be26b] {\n\tmargin: 0;\n\tmargin-bottom: 10px; /* line up with the send button */\n\tz-index: 100;\n}\n#reply-composer .message-composer[data-v-587be26b] {\n\tmargin: 0;\n}\n.composer-fields.mail-account > .multiselect[data-v-587be26b] {\n\tmax-width: none;\n\tmin-height: auto;\n\twidth: 350px;\n}\n.composer-fields[data-v-587be26b] {\n\tdisplay: flex;\n\talign-items: center;\n\tborder-top: 1px solid var(--color-border);\n\tpadding-right: 30px;\n}\n.composer-fields .multiselect[data-v-587be26b],\n.composer-fields input[data-v-587be26b],\n.composer-fields textarea[data-v-587be26b] {\n\tflex-grow: 1;\n\tmax-width: none;\n\tborder: none;\n\tborder-radius: 0px;\n}\n.noreply-box[data-v-587be26b] {\n\tmargin-top: 0;\n\tbackground: #fdffc3;\n\tpadding-left: 64px;\n}\n#to[data-v-587be26b],\n#cc[data-v-587be26b],\n#bcc[data-v-587be26b],\ninput.subject[data-v-587be26b],\ntextarea.message-body[data-v-587be26b] {\n\tpadding: 12px;\n\tmargin: 0;\n}\n#to[data-v-587be26b] {\n\tpadding-right: 60px; /* for cc-bcc-toggle */\n}\ninput.cc[data-v-587be26b],\ninput.bcc[data-v-587be26b],\ninput.subject[data-v-587be26b],\ntextarea.message-body[data-v-587be26b] {\n\tborder-top: none;\n}\ninput.subject[data-v-587be26b] {\n\tfont-size: 20px;\n\tfont-weight: 300;\n}\ntextarea.message-body[data-v-587be26b] {\n\tmin-height: 300px;\n\tresize: none;\n\tpadding-right: 25%;\n}\n#draft-status[data-v-587be26b] {\n\tpadding: 5px;\n\topacity: 0.5;\n\tfont-size: small;\n}\nlabel.to-label[data-v-587be26b],\nlabel.cc-label[data-v-587be26b],\nlabel.bcc-label[data-v-587be26b],\nlabel.subject-label[data-v-587be26b] {\n\tpadding: 12px;\n\tpadding-left: 30px;\n\tcursor: text;\n\topacity: 0.5;\n\twidth: 90px;\n\ttext-align: right;\n}\nlabel.bcc-label[data-v-587be26b] {\n\ttop: initial;\n\tbottom: 0;\n}\ntextarea.reply[data-v-587be26b] {\n\tmin-height: 100px;\n}\ninput.submit-message[data-v-587be26b],\n.submit-message-wrapper[data-v-587be26b] {\n\tposition: fixed;\n\tbottom: 10px;\n\tright: 15px;\n}\n.submit-message-wrapper[data-v-587be26b] {\n\tposition: fixed;\n\theight: 36px;\n\twidth: 60px;\n}\n.submit-message.send[data-v-587be26b] {\n\tpadding: 12px;\n}\n",""])},689:function(t,e,a){"use strict";var n=a(342);a.n(n).a},690:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.multiselect .multiselect__tags {\n\tborder: none !important;\n}\n",""])},736:function(t,e){},777:function(t,e,a){"use strict";var n=a(354);a.n(n).a},778:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n#message-container[data-v-3070be90] {\n\tposition: relative;\n\twidth: 100%;\n\theight: 0;\n\tpadding-bottom: 56.25%;\n}\n#message-frame[data-v-3070be90] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n",""])},779:function(t,e,a){"use strict";var n=a(355);a.n(n).a},780:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.mail-signature[data-v-56bdb136] {\n\tfont-family: monospace;\n\topacity: 0.5;\n\tline-height: initial;\n}\n",""])},814:function(t,e,a){"use strict";var n=a(360);a.n(n).a},815:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.attachment[data-v-63ae6cbc] {\n\tposition: relative;\n\tdisplay: inline-block;\n\tborder: 1px solid var(--color-border);\n\tborder-radius: 3px;\n\tmargin: 0 10px 10px 0;\n\tpadding: 5px;\n}\n.attachment[data-v-63ae6cbc]:hover,\n.attachment span[data-v-63ae6cbc]:hover {\n\tbackground-color: var(--color-background-dark);\n\tcursor: pointer;\n}\n@media only screen and (max-width: 768px) {\n.attachment[data-v-63ae6cbc] {\n\t\twidth: calc(100% - 5px);\n}\n}\n@media only screen and (min-width: 769px) and (max-width: 1400px) {\n.attachment[data-v-63ae6cbc] {\n\t\twidth: calc(50% - 10px);\n}\n}\n@media only screen and (min-width: 1401px) {\n.attachment[data-v-63ae6cbc] {\n\t\twidth: calc(33% - 12px);\n}\n}\n.mail-attached-image[data-v-63ae6cbc] {\n\tdisplay: block;\n\tmax-width: 100%;\n\tmax-height: 120px;\n}\n.attachment-save-to-cloud[data-v-63ae6cbc],\n.attachment-download[data-v-63ae6cbc],\n.attachment-import[data-v-63ae6cbc] {\n\tposition: absolute;\n\theight: 32px;\n\twidth: 32px;\n\tmargin: 0;\n\tbottom: 0;\n\tbackground-color: transparent;\n\tborder-color: transparent;\n}\n.attachment-save-to-cloud[data-v-63ae6cbc] {\n\tright: 0;\n}\n.attachment-download[data-v-63ae6cbc] {\n\tright: 32px;\n\topacity: 0.6;\n}\n.attachment-import[data-v-63ae6cbc] {\n\tright: 64px;\n}\n.attachment-import-popover[data-v-63ae6cbc] {\n\tright: 32px;\n\ttop: 42px;\n}\n.attachment-import-popover[data-v-63ae6cbc]::after {\n\tright: 32px;\n}\n.attachment-name[data-v-63ae6cbc] {\n\tdisplay: inline-block;\n\twidth: calc(100% - 108px);\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tvertical-align: middle;\n}\n\n/* show attachment size less prominent */\n.attachment-size[data-v-63ae6cbc] {\n\t-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=50)';\n\topacity: 0.5;\n}\n.attachment-icon[data-v-63ae6cbc] {\n\tvertical-align: middle;\n}\n",""])},816:function(t,e,a){"use strict";var n=a(361);a.n(n).a},817:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.mail-message-attachments {\n\tmargin-bottom: 20px;\n}\n\n/* show icon + text for Download all button\n\t\tas well as when there is only one attachment */\n.attachments-save-to-cloud {\n\tbackground-position: 9px center;\n\tpadding-left: 32px;\n}\n",""])},818:function(t,e,a){"use strict";var n=a(362);a.n(n).a},819:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.mail-message-body {\n\tmargin-bottom: 100px;\n}\n#mail-message-header h2,\n#mail-message-header p {\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tpadding-bottom: 7px;\n\tmargin-bottom: 0;\n}\n#mail-content,\n.mail-message-attachments {\n\tmargin: 10px 10px 50px 30px;\n}\n.mail-message-attachments {\n\tmargin-top: 10px;\n}\n#mail-content iframe {\n\twidth: 100%;\n}\n#show-images-text {\n\tdisplay: none;\n}\n#mail-content a,\n.mail-signature a {\n\tcolor: #07d;\n\tborder-bottom: 1px dotted #07d;\n\ttext-decoration: none;\n\tword-wrap: break-word;\n}\n#mail-message-header .transparency {\n\topacity: 0.6;\n}\n#mail-message-header .transparency a {\n\tfont-weight: bold;\n}\n@media print {\n#mail-message-header {\n\t\tposition: relative;\n}\n#header,\n\t#app-navigation,\n\t#reply-composer,\n\t#forward-button,\n\t#mail-message-has-blocked-content,\n\t.app-content-list,\n\t.message-composer,\n\t.mail-message-attachments {\n\t\tdisplay: none !important;\n}\n#app-content {\n\t\tmargin-left: 0 !important;\n}\n.mail-message-body {\n\t\tmargin-bottom: 0 !important;\n}\n}\n",""])},820:function(t,e,a){"use strict";var n=a(363);a.n(n).a},821:function(t,e,a){(t.exports=a(257)(!1)).push([t.i,"\n.app-content-details[data-v-6b51141c] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n}\n.icon[data-v-6b51141c] {\n\theight: 64px;\n\twidth: 64px;\n\tmargin: 0 auto 15px;\n\tbackground-size: 64px;\n\topacity: 0.4;\n}\nh2[data-v-6b51141c],\np[data-v-6b51141c] {\n\ttext-align: center;\n}\n",""])},825:function(e,a,n){"use strict";n.r(a);n(284),n(136);var s=n(280),o=n.n(s),r=n(292),i=(n(368),n(0)),c=n.n(i),l=n(311),d=n.n(l),u=n(369),m=n.n(u),p={name:"AppDetailsToggle",mixins:[m.a]},h=(n(564),n(70)),f=Object(h.a)(p,function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isMobile?a("div",{staticClass:"toggle icon-confirm",attrs:{tabindex:"0"},on:{click:function(e){return t.$emit("close")}}}):t._e()},[],!1,null,"a9d24ca6",null).exports,g=n(566),v=n.n(g),b=n(567),y=n.n(b),x=n(568),j=n(1),_={name:"EmptyFolder"},w=Object(h.a)(_,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"emptycontent"}},[e("div",{staticClass:"icon-mail"}),this._v(" "),e("h2",[this._v(this._s(this.t("mail","No messages in this folder")))])])},[],!1,null,null,null).exports,C=(n(72),n(627)),A=n.n(C),k=n(628),I=n.n(k),S=(n(334),n(8)),M=n(256),O=n.n(M);"undefined"!=typeof OC&&O.a.locale(Object(S.getLocale)());var N={name:"Moment",props:{timestamp:{type:Number,required:!0},format:{type:String,default:"LLL"}},computed:{title:function(){return O.a.unix(this.timestamp).format(this.format)},formatted:function(){return O.a.unix(this.timestamp).fromNow()}}},T=Object(h.a)(N,function(){var t=this.$createElement;return(this._self._c||t)("span",{staticClass:"live-relative-timestamp",attrs:{"data-timestamp":1e3*this.timestamp,title:this.title}},[this._v(this._s(this.formatted))])},[],!1,null,null,null).exports,E=n(634),D=n.n(E),U=n(3),L=n.n(U),P=n(2),R=c.a.memoize(function(t){if(null===t)return Promise.resolve(void 0);var e=Object(P.generateUrl)("/apps/mail/api/avatars/url/{email}",{email:t});return L.a.get(e).then(function(t){return t.data}).then(function(e){return e.isExternal?Object(P.generateUrl)("/apps/mail/api/avatars/image/{email}",{email:t}):e.url}).catch(function(t){if(404!==t.response.status)return Promise.reject(t)})}),B={name:"Avatar",components:{BaseAvatar:D.a},props:{displayName:{type:String,required:!0},email:{type:String,required:!0}},data:function(){return{loading:!0,avatarUrl:void 0}},computed:{hasAvatar:function(){return!c.a.isUndefined(this.avatarUrl)}},mounted:function(){var t=this;R(this.email).then(function(e){t.avatarUrl=e,t.loading=!1})}},z=Object(h.a)(B,function(){var t=this.$createElement,e=this._self._c||t;return this.loading||!this.hasAvatar?e("BaseAvatar",{attrs:{"display-name":this.displayName}}):e("BaseAvatar",{attrs:{"display-name":this.displayName,url:this.avatarUrl}})},[],!1,null,null,null).exports,F=n(270),q={name:"Envelope",components:{Actions:A.a,ActionButton:I.a,Avatar:z,Moment:T},props:{data:{type:Object,required:!0},showAccountColor:{type:Boolean,default:!1}},computed:{accountColor:function(){return Object(F.a)(this.$store.getters.getAccount(this.data.accountId).emailAddress)},draft:function(){return this.data.flags.draft},link:function(){return this.draft?{name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:"new",draftUid:this.data.uid},exact:!0}:{name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:this.data.uid},exact:!0}},sender:function(){if(0===this.data.from.length)return"?";var t=this.data.from[0];return t.label||t.email},senderEmail:function(){return this.data.from.length>0?this.data.from[0].email:void 0}},methods:{onToggleFlagged:function(){this.$store.dispatch("toggleEnvelopeFlagged",this.data)},onToggleSeen:function(){this.$store.dispatch("toggleEnvelopeSeen",this.data)},onDelete:function(t){t.preventDefault(),this.$emit("delete",this.data),this.$store.dispatch("deleteMessage",this.data)}}},V=(n(635),Object(h.a)(q,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-link",{staticClass:"app-content-list-item",class:{unseen:t.data.flags.unseen,draft:t.draft},attrs:{to:t.link}},[t.showAccountColor?a("div",{staticClass:"mail-message-account-color",style:{"background-color":t.accountColor}}):t._e(),t._v(" "),a("div",{staticClass:"app-content-list-item-star icon-starred",attrs:{"data-starred":t.data.flags.flagged?"true":"false"},on:{click:function(e){return e.preventDefault(),t.onToggleFlagged(e)}}}),t._v(" "),a("div",{staticClass:"app-content-list-item-icon"},[a("Avatar",{attrs:{"display-name":t.sender,email:t.senderEmail}})],1),t._v(" "),a("div",{staticClass:"app-content-list-item-line-one",attrs:{title:t.sender}},[t._v("\n\t\t"+t._s(t.sender)+"\n\t")]),t._v(" "),a("div",{staticClass:"app-content-list-item-line-two",attrs:{title:t.data.subject}},[t.data.flags.answered?a("span",{staticClass:"icon-reply"}):t._e(),t._v(" "),t.data.flags.hasAttachments?a("span",{staticClass:"icon-public icon-attachment"}):t._e(),t._v(" "),t.draft?a("span",{staticClass:"draft"},[a("em",[t._v(t._s(t.t("mail","Draft: ")))])]):t._e(),t._v("\n\t\t"+t._s(t.data.subject)+"\n\t")]),t._v(" "),a("div",{staticClass:"app-content-list-item-details date"},[a("Moment",{attrs:{timestamp:t.data.dateInt}})],1),t._v(" "),a("Actions",{staticClass:"app-content-list-item-menu",attrs:{"menu-align":"right"}},[a("ActionButton",{attrs:{icon:"icon-mail"},on:{click:t.onToggleSeen}},[t._v(t._s(t.data.flags.unseen?t.t("mail","Mark read"):t.t("mail","Mark unread")))]),t._v(" "),a("ActionButton",{attrs:{icon:"icon-delete"},on:{click:t.onDelete}},[t._v(t._s(t.t("mail","Delete")))])],1)],1)},[],!1,null,"30996fff",null).exports),W=n(19);j.default.use(x.a,{throttle:600});var H={name:"EnvelopeList",components:{AppContentList:v.a,Envelope:V,EmptyFolder:w},directives:{infiniteScroll:y.a},props:{account:{type:Object,required:!0},folder:{type:Object,required:!0},envelopes:{type:Array,required:!0},searchQuery:{type:String,required:!1,default:void 0},show:{type:Boolean,default:!0}},data:function(){return{loadingMore:!1,refreshing:!1,shortkeys:{del:["del"],flag:["s"],next:["arrowright"],prev:["arrowleft"],refresh:["r"],unseen:["u"]}}},computed:{isSearch:function(){return!c.a.isUndefined(this.searchQuery)}},methods:{loadMore:function(){var t=this;this.loadingMore=!0,this.$store.dispatch("fetchNextEnvelopePage",{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,query:this.searchQuery}).catch(function(t){return W.a.error("could not fetch next envelope page",{error:t})}).then(function(){t.loadingMore=!1})},sync:function(){var t=this;this.refreshing=!0,this.$store.dispatch("syncEnvelopes",{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId}).catch(function(t){return W.a.error("could not sync envelopes",{error:t})}).then(function(){t.refreshing=!1})},onEnvelopeDeleted:function(t){var e,a=this.envelopes,n=this.envelopes.indexOf(t);-1!==n?t.uid===this.$route.params.messageUid?(e=0===n?a[n+1]:a[n-1])?this.$router.push({name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:e.uid}}):W.a.debug("no next/previous envelope, not navigating"):W.a.debug("other message open, not jumping to the next/previous message"):W.a.debug("envelope to delete does not exist in envelope list")},onScroll:function(t,e){if(0===e.scrollTop&&!this.refreshing)return this.sync()},handleShortcut:function(t){var e=this.envelopes,a=this.$route.params.messageUid;if(a){var n=e.filter(function(t){return t.uid==a});if(0!==n.length){var s=n[0],o=e.indexOf(s);switch(t.srcKey){case"next":case"prev":var r;if(!(r="next"===t.srcKey?e[o+1]:e[o-1]))return void W.a.debug("ignoring shortcut: head or tail of envelope list reached",{envelopes:e,idx:o,srcKey:t.srcKey});this.$router.push({name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:r.uid}});break;case"del":W.a.debug("deleting",{env:s}),this.$store.dispatch("deleteMessage",s).catch(function(t){return W.a.error("could not delete envelope",{env:s,error:t})});break;case"flag":W.a.debug("flagging envelope via shortkey",{env:s}),this.$store.dispatch("toggleEnvelopeFlagged",s).catch(function(t){return W.a.error("could not flag envelope via shortkey",{env:s,error:t})});break;case"refresh":W.a.debug("syncing envelopes via shortkey"),this.refreshing||this.sync();break;case"unseen":W.a.debug("marking message as seen/unseen via shortkey",{env:s}),this.$store.dispatch("toggleEnvelopeSeen",s).catch(function(t){return W.a.error("could not mark envelope as seen/unseen via shortkey",{env:s,error:t})});break;default:W.a.warn("shortcut "+t.srcKey+" is unknown. ignoring.")}}else W.a.debug("ignoring shortcut: currently displayed messages is not in current envelope list")}else W.a.debug("ignoring shortcut: no envelope selected")}}},G=(n(639),Object(h.a)(H,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppContentList",{attrs:{"show-details":!t.show}},[a("transition-group",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"},{name:"scroll",rawName:"v-scroll",value:t.onScroll,expression:"onScroll"},{name:"shortkey",rawName:"v-shortkey.once",value:t.shortkeys,expression:"shortkeys",modifiers:{once:!0}}],attrs:{name:"list","infinite-scroll-disabled":"loading","infinite-scroll-distance":"30"},nativeOn:{shortkey:function(e){return t.handleShortcut(e)}}},[a("div",{key:"loading",staticClass:"icon-loading-small",class:{refreshing:t.refreshing},attrs:{id:"list-refreshing"}}),t._v(" "),0===t.envelopes.length?a("EmptyFolder",{key:"empty"}):t._l(t.envelopes,function(e){return a("Envelope",{key:e.uid,attrs:{data:e,"show-account-color":t.folder.isUnified},on:{delete:t.onEnvelopeDeleted}})}),t._v(" "),a("div",{key:"loadingMore",class:{"icon-loading-small":t.loadingMore},attrs:{id:"load-more-mail-messages"}})],2)],1)},[],!1,null,"0bf2f7be",null).exports),K={name:"Loading",props:{hint:{type:String,default:function(){}}}},Y=Object(h.a)(K,function(){var t=this.$createElement,e=this._self._c||t;return this.hint?e("div",{staticClass:"emptycontent"},[e("a",{staticClass:"icon-loading"}),this._v(" "),e("h2",[this._v(this._s(this.hint))])]):e("div",{staticClass:"container icon-loading"})},[],!1,null,"8aa72af6",null).exports,Z=n(287),Q=n.n(Z),J={name:"Address",props:{email:{type:String,required:!0},label:{type:String,required:!0}},computed:{newMessageRoute:function(){return{name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:"new"},query:{to:this.email}}}}},X={name:"AddressList",components:{Address:Object(h.a)(J,function(){var t=this.$createElement;return(this._self._c||t)("router-link",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:this.email,expression:"email",modifiers:{bottom:!0}}],attrs:{to:this.newMessageRoute,exact:""}},[this._v(this._s(this.label)+" ")])},[],!1,null,null,null).exports},props:{entries:{type:Array,required:!0}}},tt=Object(h.a)(X,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t._l(t.entries,function(e,n){return[a("Address",{key:e.email,attrs:{email:e.email,label:e.label}}),n+1<t.entries.length?a("span",{key:e.email},[t._v(", ")]):t._e()]})],2)},[],!1,null,null,null).exports;n(510),n(511),n(281);
/**
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
O.a.locale(Object(S.getLocale)());var et=function(t,e,a){var n="\n> "+t.replace(/\n/g,"\n> ");if(e){var s=O.a.unix(a).format("LLL");return"\n\n"+'"'.concat(e.label,'" <').concat(e.email,"> – ").concat(s)+n}return"\n\n"+n},at=Object.seal({None:0,To:1,Cc:2}),nt=["re"],st=["fwd"],ot=(n(512),n(645)),rt=n.n(ot),it=n(648),ct=n.n(it),lt=n(649),dt=n.n(lt),ut=(n(20),n(140),n(513));
/*
 * @copyright 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @author 2018 Christoph Wurst <christoph@winzerhof-wurst.at>
 *
 * @license GNU AGPL version 3 or any later version
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
function mt(t,e,a,n,s){var o=Object(P.generateUrl)("apps/mail/api/accounts/{accountId}/folders/{folderId}/messages/{messageId}/attachment/{attachmentId}",{accountId:t,folderId:e,messageId:a,attachmentId:n});return L.a.post(o,{targetPath:s})}var pt={name:"ComposerAttachments",props:{value:{type:Array,required:!0}},data:function(){return{uploading:!1,uploads:{}}},computed:{uploadProgress:function(){var t=0,e=0;for(var a in this.uploads)t+=this.uploads[a].uploaded,e+=this.uploads[a].total;return(t/e*100).toFixed(1)}},methods:{onAddLocalAttachment:function(){this.$refs.localAttachments.click()},fileNameToAttachment:function(t,e){return{fileName:t,displayName:c.a.trimStart(t,"/"),id:e,isLocal:!c.a.isUndefined(e)}},emitNewAttachment:function(t){this.$emit("input",this.value.concat([t]))},onLocalAttachmentSelected:function(t){var e=this;this.uploading=!0,j.default.set(this,"uploads",{});var a=c.a.map(t.target.files,function(t){return j.default.set(e.uploads,t.name,{total:t.size,uploaded:0}),function(t,e){var a=Object(P.generateUrl)("/apps/mail/api/attachments"),n=new FormData,s={onUploadProgress:function(t){return e(t,t.loaded,t.total)}};return n.append("attachment",t),L.a.post(a,n,s).then(function(t){return t.data}).then(function(e){var a=e.id;return{file:t,id:a}})}(t,(a=t.name,function(t,n){e.uploads[a].uploaded=n})).then(function(t){var a=t.file,n=t.id;return W.a.info("uploaded"),e.emitNewAttachment(e.fileNameToAttachment(a.name,n))});var a}),n=Promise.all(a).catch(function(t){return W.a.error("could not upload all attachments",{error:t})}).then(function(){return e.uploading=!1});return this.$emit("upload",n),n},onAddCloudAttachment:function(){var t=this;return Object(ut.getFilePickerBuilder)(Object(S.translate)("mail","Choose a file to add as attachment")).build().pick(Object(S.translate)("mail","Choose a file to add as attachment")).then(function(e){return t.emitNewAttachment(t.fileNameToAttachment(e))}).catch(function(t){return W.a.error("could not choose a file as attachment",{error:t})})},onDelete:function(t){this.$emit("input",this.value.filter(function(e){return e!==t}))}}},ht=(n(685),Object(h.a)(pt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-message-attachments"},[a("ul",t._l(t.value,function(e){return a("li",{key:e.id},[a("div",{staticClass:"new-message-attachment-name"},[t._v("\n\t\t\t\t"+t._s(e.displayName)+"\n\t\t\t")]),t._v(" "),a("div",{staticClass:"new-message-attachments-action svg icon-delete",on:{click:function(a){return t.onDelete(e)}}})])}),0),t._v(" "),a("button",{staticClass:"button",attrs:{disabled:t.uploading},on:{click:t.onAddLocalAttachment}},[a("span",{class:{"icon-upload":!t.uploading,"icon-loading-small":t.uploading}}),t._v("\n\t\t"+t._s(t.uploading?t.t("mail","Uploading {percent}% …",{percent:t.uploadProgress}):t.t("mail","Upload attachment"))+"\n\t")]),t._v(" "),a("button",{staticClass:"button",on:{click:t.onAddCloudAttachment}},[a("span",{staticClass:"icon-folder"}),t._v("\n\t\t"+t._s(t.t("mail","Add attachment from Files"))+"\n\t")]),t._v(" "),a("input",{ref:"localAttachments",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.onLocalAttachmentSelected}})])},[],!1,null,"40de8a78",null).exports),ft=ct()(function(t){var e=Object(P.generateUrl)("/apps/mail/api/autoComplete?term={term}",{term:t});return L.a.get(e).then(function(t){return t.data})},500);j.default.use(rt.a);var gt=Object.seal({EDITING:0,UPLOADING:1,SENDING:2,ERROR:3,FINISHED:4}),vt={name:"Composer",components:{ComposerAttachments:ht,Loading:Y,Multiselect:dt.a},props:{replyTo:{type:Object,default:function(){}},fromAccount:{type:Number,default:function(){}},to:{type:Array,default:function(){return[]}},cc:{type:Array,default:function(){return[]}},bcc:{type:Array,default:function(){return[]}},subject:{type:String,default:""},body:{type:String,default:""},draft:{type:Function,required:!0},send:{type:Function,required:!0}},data:function(){return{showCC:this.cc.length>0,selectedAlias:-1,autocompleteRecipients:this.to.concat(this.cc).concat(this.bcc),newRecipients:[],subjectVal:this.subject,bodyVal:this.body,attachments:[],noReply:this.to.some(function(t){return t.email.startsWith("noreply@")||t.email.startsWith("no-reply@")}),submitButtonTitle:t("mail","Send"),draftsPromise:Promise.resolve(),attachmentsPromise:Promise.resolve(),savingDraft:void 0,saveDraftDebounced:c.a.debounce(this.saveDraft,700),state:gt.EDITING,errorText:void 0,STATES:gt,selectTo:this.to,selectCc:this.cc,selectBcc:this.bcc}},computed:{aliases:function(){return this.$store.getters.getAccounts().filter(function(t){return!t.isUnified})},selectableRecipients:function(){return this.newRecipients.concat(this.autocompleteRecipients)},isReply:function(){return!c.a.isUndefined(this.replyTo)},noSubject:function(){return""===this.subjectVal&&""!==this.bodyVal}},beforeMount:function(){var t=this;this.fromAccount?this.selectedAlias=this.aliases.find(function(e){return e.id===t.fromAccount}):this.selectedAlias=this.aliases[0],this.bodyVal=this.bodyWithSignature(this.selectedAlias,this.body)},methods:{recipientToRfc822:function(t){return t.email===t.label?t.email:""===t.label?t.email:0===t.email.search(/^[a-zA-Z]+:[a-zA-Z]+$/)?t.email:'"'.concat(t.label,'" <').concat(t.email,">")},getMessageData:function(){var t=this;return function(e){return{account:t.selectedAlias.id,to:t.selectTo.map(t.recipientToRfc822).join(", "),cc:t.selectCc.map(t.recipientToRfc822).join(", "),bcc:t.selectBcc.map(t.recipientToRfc822).join(", "),draftUID:e,subject:t.subjectVal,body:t.bodyVal,attachments:t.attachments,folderId:t.replyTo?t.replyTo.folderId:void 0,messageId:t.replyTo?t.replyTo.messageId:void 0}}},saveDraft:function(t){var e=this;this.savingDraft=!0,this.draftsPromise=this.draftsPromise.then(function(a){return e.draft(t(a))}).catch(W.a.error).then(function(t){return e.savingDraft=!1,t})},onInputChanged:function(){this.saveDraftDebounced(this.getMessageData())},onAutocomplete:function(t){var e=this;c.a.isUndefined(t)||""===t||ft(t).then(function(t){e.autocompleteRecipients=c.a.uniqBy(e.autocompleteRecipients.concat(t),"email")})},onAttachmentsUploading:function(t){this.attachmentsPromise=this.attachmentsPromise.then(function(){return t}).catch(function(t){return W.a.error("could not upload attachments",{error:t})}).then(function(){return W.a.debug("attachments uploaded")})},onBodyKeyPress:function(t){if(13===t.keyCode&&t.ctrlKey)return this.onSend()},onNewToAddr:function(t){this.onNewAddr(t,this.selectTo)},onNewCcAddr:function(t){this.onNewAddr(t,this.selectCc)},onNewBccAddr:function(t){this.onNewAddr(t,this.selectBcc)},onNewAddr:function(t,e){var a={label:t,email:t};this.newRecipients.push(a),e.push(a)},onSend:function(){var t=this;return this.state=gt.UPLOADING,this.attachmentsPromise.then(function(){return t.state=gt.SENDING}).then(function(){return t.draftsPromise}).then(this.getMessageData()).then(function(e){return t.send(e)}).then(function(){return W.a.info("message sent")}).then(function(){return t.state=gt.FINISHED}).catch(function(e){W.a.error("could not send message",{error:e}),e&&e.toString&&(t.errorText=e.toString()),t.state=gt.ERROR})},reset:function(){this.selectTo=[],this.selectCc=[],this.selectBcc=[],this.subjectVal="",this.bodyVal="",this.attachments=[],this.errorText=void 0,this.state=gt.EDITING},formatAliases:function(t){return"".concat(t.name," <").concat(t.emailAddress,">")},bodyWithSignature:function(t,e){return t&&t.signature?e+"\n\n--\n\n"+t.signature:e}}},bt=(n(687),n(689),Object(h.a)(vt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.state===t.STATES.EDITING?a("div",{staticClass:"message-composer"},[a("div",{staticClass:"composer-fields mail-account"},[a("label",{staticClass:"to-label transparency",attrs:{for:"from"}},[t._v("\n\t\t\t"+t._s(t.t("mail","from"))+"\n\t\t")]),t._v(" "),a("Multiselect",{attrs:{id:"from",options:t.aliases,label:"name","track-by":"id","custom-label":t.formatAliases},on:{keyup:t.onInputChanged},model:{value:t.selectedAlias,callback:function(e){t.selectedAlias=e},expression:"selectedAlias"}})],1),t._v(" "),a("div",{staticClass:"composer-fields"},[a("label",{staticClass:"to-label transparency",attrs:{for:"to"}},[t._v("\n\t\t\t"+t._s(t.t("mail","to"))+"\n\t\t")]),t._v(" "),a("Multiselect",{attrs:{id:"to",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0},on:{keyup:t.onInputChanged,tag:t.onNewToAddr,"search-change":t.onAutocomplete},model:{value:t.selectTo,callback:function(e){t.selectTo=e},expression:"selectTo"}}),t._v(" "),t.showCC?t._e():a("a",{attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.showCC=!0}}},[t._v("\n\t\t\t"+t._s(t.t("mail","+ cc/bcc"))+"\n\t\t")])],1),t._v(" "),t.showCC?a("div",{staticClass:"composer-fields"},[a("label",{staticClass:"cc-label transparency",attrs:{for:"cc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","cc"))+"\n\t\t")]),t._v(" "),a("Multiselect",{attrs:{id:"cc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0},on:{keyup:t.onInputChanged,tag:t.onNewCcAddr,"search-change":t.onAutocomplete},model:{value:t.selectCc,callback:function(e){t.selectCc=e},expression:"selectCc"}})],1):t._e(),t._v(" "),t.showCC?a("div",{staticClass:"composer-fields"},[a("label",{staticClass:"bcc-label transparency",attrs:{for:"bcc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","bcc"))+"\n\t\t")]),t._v(" "),a("Multiselect",{attrs:{id:"bcc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0},on:{keyup:t.onInputChanged,tag:t.onNewBccAddr,"search-change":t.onAutocomplete},model:{value:t.selectBcc,callback:function(e){t.selectBcc=e},expression:"selectBcc"}})],1):t._e(),t._v(" "),a("div",{staticClass:"composer-fields"},[a("label",{staticClass:"subject-label transparency",attrs:{for:"subject"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Subject"))+"\n\t\t")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.subjectVal,expression:"subjectVal"}],staticClass:"subject",attrs:{id:"subject",type:"text",name:"subject",autocomplete:"off",placeholder:t.t("mail","Subject")},domProps:{value:t.subjectVal},on:{keyup:t.onInputChanged,input:function(e){e.target.composing||(t.subjectVal=e.target.value)}}})]),t._v(" "),t.noSubject?a("div",{staticClass:"warning"},[t._v("\n\t\t"+t._s(t.t("mail","This mail does not have a subject yet."))+"\n\t")]):t._e(),t._v(" "),t.noReply?a("div",{staticClass:"warning noreply-box"},[t._v("\n\t\t"+t._s(t.t("mail","Note that the mail came from a noreply address so\tyour reply will probably not be read."))+"\n\t")]):t._e(),t._v(" "),a("div",{staticClass:"composer-fields"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bodyVal,expression:"bodyVal"},{name:"autosize",rawName:"v-autosize"}],staticClass:"message-body",attrs:{name:"body",placeholder:t.t("mail","Message …")},domProps:{value:t.bodyVal},on:{keyup:t.onInputChanged,keypress:t.onBodyKeyPress,input:function(e){e.target.composing||(t.bodyVal=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"submit-message-wrapper"},[a("input",{staticClass:"submit-message send primary",attrs:{type:"submit"},domProps:{value:t.submitButtonTitle},on:{click:t.onSend}})]),t._v(" "),a("ComposerAttachments",{on:{upload:t.onAttachmentsUploading},model:{value:t.attachments,callback:function(e){t.attachments=e},expression:"attachments"}}),t._v(" "),!0===t.savingDraft?a("span",{attrs:{id:"draft-status"}},[t._v(t._s(t.t("mail","Saving draft …")))]):!1===t.savingDraft?a("span",{attrs:{id:"draft-status"}},[t._v(t._s(t.t("mail","Draft saved")))]):t._e()],1):t.state===t.STATES.UPLOADING?a("Loading",{attrs:{hint:t.t("mail","Uploading attachments …")}}):t.state===t.STATES.SENDING?a("Loading",{attrs:{hint:t.t("mail","Sending …")}}):t.state===t.STATES.ERROR?a("div",{staticClass:"emptycontent"},[a("h2",[t._v(t._s(t.t("mail","Error sending your message")))]),t._v(" "),t.errorText?a("p",[t._v(t._s(t.errorText))]):t._e(),t._v(" "),a("button",{staticClass:"button",on:{click:function(e){t.state=t.STATES.EDITING}}},[t._v(t._s(t.t("mail","Go back")))]),t._v(" "),a("button",{staticClass:"button primary",on:{click:t.onSend}},[t._v(t._s(t.t("mail","Retry")))])]):a("div",{staticClass:"emptycontent"},[t.isReply?a("h2",[t._v(t._s(t.t("mail","Reply sent!")))]):a("h2",[t._v(t._s(t.t("mail","Message sent!")))]),t._v(" "),t.isReply?t._e():a("button",{staticClass:"button primary",on:{click:t.reset}},[t._v("\n\t\t"+t._s(t.t("mail","Write another message"))+"\n\t")])])},[],!1,null,"587be26b",null).exports),yt=(n(691),n(692)),xt=n.n(yt),jt=function(t){return t.reduce(function(t,e){var a="";return e.class?a+="  at "+e.class+"::"+e.function:a+="  at "+e.function,e.file&&(a+="\n     "+e.file+", line "+e.line),t+a+"\n"},"")},_t=function(t){console.error(t);var e=t.message||"An unkown error occurred.";e.endsWith(".")||(e+=".");var a=(new xt.a).addEmptyStepsToReproduce().addExpectedActualBehaviour().addLogs("Error",function(t){var e="";return t.type&&(e+=t.type+": "),e+=t.message,e+="\n",t.trace&&(e+=jt(t.trace)),t.stack&&(e+=t.stack),e}(t)).render();return"https://github.com/nextcloud/mail/issues/new?title="+encodeURIComponent(e)+"&body="+encodeURIComponent(a)},wt={name:"Error",props:{error:{type:String,required:!0},message:{type:String,required:!0},data:{type:Object,default:function(){}}},computed:{reportUrl:function(){return _t(this.data)}}},Ct=Object(h.a)(wt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"emptycontent"},[a("h2",[t._v(t._s(t.error))]),t._v(" "),a("p",[t._v(t._s(t.message))]),t._v(" "),t.data&&t.data.debug?a("p",[a("a",{staticClass:"button",attrs:{href:t.reportUrl,target:"_blank",rel:"noopener"}},[t._v(t._s(t.t("mail","Report this bug")))])]):t._e()])},[],!1,null,null,null).exports,At=[":-(",":-/",":-\\",":-|",":'-(",":'-/",":'-\\",":'-|"],kt=function(){return At[Math.floor(Math.random()*At.length)]},It=function(){var t=[Object(S.translate)("mail","Could not load your message"),Object(S.translate)("mail","Could not load the desired message"),Object(S.translate)("mail","Could not load the message")];return t[Math.floor(Math.random()*t.length)]+" "+kt()},St=n(693),Mt=new(n(824).a),$t={name:"MessageHTMLBody",props:{url:{type:String,required:!0}},data:function(){return{loading:!0,hasBlockedContent:!1}},beforeMount:function(){Mt.on("beforeprint",this.onBeforePrint),Mt.on("afterprint",this.onAfterPrint)},beforeDestroy:function(){Mt.off("beforeprint",this.onBeforePrint),Mt.off("afterprint",this.onAfterPrint)},methods:{getIframeDoc:function(){var t=this.$refs.iframe;return t.contentDocument||t.contentWindow.document},onMessageFrameLoad:function(){var t=this.getIframeDoc(),e=t.querySelectorAll("body")[0];this.hasBlockedContent=t.querySelectorAll("[data-original-src]").length>0||t.querySelectorAll("[data-original-style]").length>0,this.$emit("loaded",e.outerHTML),this.loading=!1},onAfterPrint:function(){this.$refs.iframe.style.setProperty("height","")},onBeforePrint:function(){this.$refs.iframe.style.setProperty("height","".concat(this.getIframeDoc().body.scrollHeight,"px"),"important")},onShowBlockedContent:function(){var t=this.getIframeDoc();t.querySelectorAll("[data-original-src]").forEach(function(t){return t.setAttribute("src",t.getAttribute("data-original-src"))}),t.querySelectorAll("[data-original-style]").forEach(function(t){return t.setAttribute("style",t.getAttribute("data-original-style"))}),this.hasBlockedContent=!1}}},Ot=(n(777),Object(h.a)($t,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"mail-content"}},[t.hasBlockedContent?a("div",{attrs:{id:"mail-message-has-blocked-content"}},[t._v("\n\t\t"+t._s(t.t("mail","The images have been blocked to protect your privacy."))+"\n\t\t"),a("button",{on:{click:t.onShowBlockedContent}},[t._v("\n\t\t\t"+t._s(t.t("mail","Show images from this\tsender"))+"\n\t\t")])]):t._e(),t._v(" "),t.loading?a("div",{staticClass:"icon-loading"}):t._e(),t._v(" "),a("div",{class:{hidden:t.loading},attrs:{id:"message-container"}},[a("iframe",{ref:"iframe",attrs:{id:"message-frame",src:t.url,seamless:""},on:{load:t.onMessageFrameLoad}})])])},[],!1,null,"3070be90",null).exports),Nt={name:"MessagePlainTextBody",props:{body:{type:String,required:!0},signature:{type:String,default:function(){}}}},Tt=(n(779),Object(h.a)(Nt,function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:"mail-content"},domProps:{innerHTML:this._s(this.body)}}),this._v(" "),this.signature?e("div",{staticClass:"mail-signature",domProps:{innerHTML:this._s(this.signature)}}):this._e()])},[],!1,null,"56bdb136",null).exports),Et=n(781),Dt=n(810),Ut=n(811),Lt=n.n(Ut),Pt=n(77),Rt=(n(78),n(812)),Bt=n.n(Rt),zt=n(813),Ft=n.n(zt),qt=n(45),Vt=new Bt.a.Client({baseUrl:Object(P.generateRemoteUrl)("dav/calendars"),xmlNamespaces:{"DAV:":"d","urn:ietf:params:xml:ns:caldav":"c","http://apple.com/ns/ical/":"aapl","http://owncloud.org/ns":"oc","http://calendarserver.org/ns/":"cs"}}),Wt=["{DAV:}displayname","{urn:ietf:params:xml:ns:caldav}calendar-description","{urn:ietf:params:xml:ns:caldav}calendar-timezone","{http://apple.com/ns/ical/}calendar-order","{http://apple.com/ns/ical/}calendar-color","{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set","{http://owncloud.org/ns}calendar-enabled","{DAV:}acl","{DAV:}owner","{http://owncloud.org/ns}invite"],Ht=function(){var t=Object(P.generateRemoteUrl)("dav/calendars")+"/"+Object(qt.getCurrentUser)().uid+"/";return Object(qt.getRequestToken)().then(function(e){return Vt.propFind(t,Wt,1,{requesttoken:e})}).then(function(t){var e=[];return t.body.forEach(function(t){if(!(t.propStat.length<1)&&200===function(t){return parseInt(t.split(" ")[1])}(t.propStat[0].status)){var a=function(t){!function(t){var e=!1,a=t["{DAV:}acl"];if(a)for(var n=0;n<a.length;n++){var s=a[n].getElementsByTagNameNS("DAV:","href");if(0!==s.length)s=s[0].textContent,a[n].getElementsByTagNameNS("DAV:","write").length>0&&(e=!0)}t.canWrite=e}(t);for(var e={displayname:t["{DAV:}displayname"],color:t["{http://apple.com/ns/ical/}calendar-color"],order:t["{http://apple.com/ns/ical/}calendar-order"],components:{vevent:!1},writable:t.canWrite},a=t["{urn:ietf:params:xml:ns:caldav}supported-calendar-component-set"]||[],n=0;n<a.length;n++){var s=a[n].attributes.getNamedItem("name").textContent.toLowerCase();e.components.hasOwnProperty(s)&&(e.components[s]=!0)}return e}(t.propStat[0].properties);a&&a.components.vevent&&!0===a.writable&&(a.url=t.href,e.push(a))}}),e})},Gt=function(){for(var t="",e=0;e<7;e++)t+=Math.random().toString(36).substring(7);return t},Kt=function(t){return function(e){W.a.debug("importing event into calendar",{url:t,data:e});var a=[],n=function(t){var e=[],a={},n=Ft.a.parse(t),s=new Ft.a.Component(n);s.getAllSubcomponents("vtimezone").forEach(function(t){return e.push(t)});var o=["vevent","vjournal","vtodo"];o.forEach(function(t){var e=s.getAllSubcomponents(t);a[t]={},e.forEach(function(e){var n=e.getFirstPropertyValue("uid");a[t][n]=a[t][n]||[],a[t][n].push(e)})});var r=[];return o.forEach(function(t){for(var n in r[t]=[],a[t]){var s=a[t][n],o=(c=void 0,(c=new Ft.a.Component(["vcalendar",[],[]])).updatePropertyWithValue("prodid","-//"+OC.theme.name+" Mail"),c);for(var i in e.forEach(o.addSubcomponent),s)o.addSubcomponent(s[i]);r[t].push(o.toString())}var c}),{name:s.getFirstPropertyValue("x-wr-calname"),color:s.getFirstPropertyValue("x-apple-calendar-color"),split:r}}(e);return["vevent","vjournal","vtodo"].forEach(function(e){for(var s in n.split[e]){var o=n.split[e][s];a.push(Promise.resolve($.ajax({url:t+Gt(),method:"PUT",contentType:"text/calendar; charset=utf-8",data:o})))}}),Promise.all(a)}},Yt={name:"MessageAttachment",components:{PopoverMenu:Lt.a},mixins:[Dt.mixin],props:{id:{type:Number,required:!0},fileName:{type:String,required:!0},url:{type:String,required:!0},size:{type:Number,required:!0},mimeUrl:{type:String,required:!0},isImage:{type:Boolean,default:!1},isCalendarEvent:{type:Boolean,default:!1}},data:function(){return{savingToCloud:!1,loadingCalendars:!1,calendars:[],showCalendarPopover:!1}},computed:{label:function(){return this.fileName+" ("+Object(Et.formatFileSize)(this.size)+")"},calendarMenuEntries:function(){var t=this;return this.calendars.map(function(e){return{icon:"icon-add",text:e.displayname,action:t.importCalendar(e.url)}})}},methods:{humanReadable:function(t){return Object(Et.formatFileSize)(t)},saveToCloud:function(){var e=this,a=Object(Pt.a)(this.$route.params.messageUid),n=a.accountId,s=a.folderId,o=a.id;return Object(ut.getFilePickerBuilder)(t("mail","Choose a folder to store the attachment in")).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setModal(!0).setType(1).build().pick().then(function(t){return e.savingToCloud=!0,t}).then(function(t,e,a,n){return function(s){return mt(t,e,a,n,s)}}(n,s,o,this.id)).then(function(){return W.a.info("saved")}).catch(function(t){return W.a.error("not saved",{error:t})}).then(function(){return e.savingToCloud=!1})},download:function(){window.open(this.url),window.focus()},loadCalendars:function(){var t=this;this.loadingCalendars=!0,Ht().then(function(e){t.calendars=e,t.showCalendarPopover=!0,t.loadingCalendars=!1})},closeCalendarPopover:function(){this.showCalendarPopover=!1},importCalendar:function(t){var e=this;return function(){(function(t){return L.a.get(t).then(function(t){return t.data})})(e.url).then(Kt(t)).then(function(){return W.a.info("calendar imported")}).catch(function(t){return W.a.error("import error",{error:t})}).then(function(){return e.showCalendarPopover=!1})}}}},Zt=(n(814),{name:"MessageAttachments",components:{MessageAttachment:Object(h.a)(Yt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"attachment",on:{click:t.download}},[t.isImage?a("img",{staticClass:"mail-attached-image",attrs:{src:t.url}}):t._e(),t._v(" "),a("img",{staticClass:"attachment-icon",attrs:{src:t.mimeUrl}}),t._v(" "),a("span",{staticClass:"attachment-name",attrs:{title:t.label}},[t._v(t._s(t.fileName)+"\n\t\t"),a("span",{staticClass:"attachment-size"},[t._v("("+t._s(t.humanReadable(t.size))+")")])]),t._v(" "),t.isCalendarEvent?a("button",{staticClass:"button attachment-import calendar",class:{"icon-add":!t.loadingCalendars,"icon-loading-small":t.loadingCalendars},attrs:{disabled:t.loadingCalendars,title:t.t("mail","Import into calendar")},on:{click:function(e){return e.stopPropagation(),t.loadCalendars(e)}}}):t._e(),t._v(" "),a("button",{staticClass:"button icon-download attachment-download",attrs:{title:t.t("mail","Download attachment")}}),t._v(" "),a("button",{staticClass:"attachment-save-to-cloud",class:{"icon-folder":!t.savingToCloud,"icon-loading-small":t.savingToCloud},attrs:{disabled:t.savingToCloud,title:t.t("mail","Save to Files")},on:{click:function(e){return e.stopPropagation(),t.saveToCloud(e)}}}),t._v(" "),a("div",{directives:[{name:"on-click-outside",rawName:"v-on-click-outside",value:t.closeCalendarPopover,expression:"closeCalendarPopover"}],staticClass:"popovermenu bubble attachment-import-popover hidden",class:{open:t.showCalendarPopover}},[a("PopoverMenu",{attrs:{menu:t.calendarMenuEntries}})],1)])},[],!1,null,"63ae6cbc",null).exports},props:{attachments:{type:Array,required:!0}},data:function(){return{savingToCloud:!1}},computed:{moreThanOne:function(){return this.attachments.length>1}},methods:{saveAll:function(){var e=this,a=Object(Pt.a)(this.$route.params.messageUid),n=a.accountId,s=a.folderId,o=a.id;return new Promise(function(e,a){OC.dialogs.filepicker(t("mail","Choose a folder to store the attachments in"),e,!1,"httpd/unix-directory",!0)}).then(function(t){return e.savingToCloud=!0,t}).then(function(t,e,a){return function(n){return function(t,e,a,n){return mt(t,e,a,0,n)}(t,e,a,n)}}(n,s,o)).then(function(){return W.a.info("saved")}).catch(function(t){return W.a.error("not saved",{error:t})}).then(function(){return e.savingToCloud=!1})}}}),Qt=(n(816),Object(h.a)(Zt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mail-message-attachments"},[a("div",{staticClass:"attachments"},t._l(t.attachments,function(t){return a("MessageAttachment",{key:t.id,attrs:{id:t.id,"file-name":t.fileName,size:t.size,url:t.downloadUrl,"is-image":t.isImage,"is-calendar-event":t.isCalendarEvent,"mime-url":t.mimeUrl}})}),1),t._v(" "),t.moreThanOne?a("p",[a("button",{staticClass:"attachments-save-to-cloud",class:{"icon-folder":!t.savingToCloud,"icon-loading-small":t.savingToCloud},attrs:{disabled:t.savingToCloud},on:{click:t.saveAll}},[t._v("\n\t\t\t"+t._s(t.t("mail","Save all to Files"))+"\n\t\t")])]):t._e()])},[],!1,null,null,null).exports),Jt=n(12),Xt={name:"Message",components:{AddressList:tt,AppContentDetails:Q.a,Composer:bt,Error:Ct,Loading:Y,MessageAttachments:Qt,MessageHTMLBody:Ot,MessagePlainTextBody:Tt},data:function(){return{loading:!0,message:void 0,errorMessage:"",error:void 0,htmlBodyLoaded:!1,replyRecipient:{},replySubject:"",replyBody:""}},computed:{htmlUrl:function(){return Object(P.generateUrl)("/apps/mail/api/accounts/{accountId}/folders/{folderId}/messages/{id}/html",{accountId:this.message.accountId,folderId:this.message.folderId,id:this.message.id})},replyTo:function(){return{accountId:this.message.accountId,folderId:this.message.folderId,messageId:this.message.id}}},watch:{$route:function(t,e){this.fetchMessage()}},created:function(){this.fetchMessage()},methods:{fetchMessage:function(){var e=this;this.loading=!0,this.message=void 0,this.errorMessage="",this.error=void 0,this.replyRecipient={},this.replySubject="",this.replyBody="",this.htmlBodyLoaded=!1;var a=this.$route.params.messageUid;this.$store.dispatch("fetchMessage",a).then(function(t){if(t.uid===e.$route.params.messageUid){if(e.message=t,c.a.isUndefined(e.message))return W.a.info("message could not be found",{messageUid:a}),e.errorMessage=It(),void(e.loading=!1);var n,s=e.$store.getters.getAccount(t.accountId);e.replyRecipient=function(t,e){var a=at.None,n=function(t){return t.email===e.email},s=c.a.negate(n),o=t.to.find(n);c.a.isUndefined(o)?(o=t.cc.find(n),c.a.isUndefined(o)?o=e:a=at.Cc):a=at.To;var r=[],i=[];return a===at.To?(r=(r=t.to.filter(s)).concat(t.from),i=t.cc):a===at.Cc?(r=t.to.concat(t.from),i=t.cc.filter(s)):(r=(r=t.to).concat(t.from),i=t.cc),{to:r,from:o?[o]:[],cc:i}}(t,{label:s.name,email:s.emailAddress}),e.replySubject=(n=t.subject,nt.some(function(t){return n.toLowerCase().startsWith("".concat(t,":"))})?n:"RE: ".concat(n)),t.hasHtmlBody||e.setReplyText(t.body),e.loading=!1;var o=e.$store.getters.getEnvelope(t.accountId,t.folderId,t.id);if(o.flags.unseen)return e.$store.dispatch("toggleEnvelopeSeen",o)}else W.a.debug("User navigated away, loaded message won't be shown nor flagged as seen")}).catch(function(n){W.a.error("could not load message ",{messageUid:a,error:n}),n.isError&&(e.errorMessage=t("mail","Could not load your message"),e.error=n,e.loading=!1)})},setReplyText:function(t){var e,a=(e=t,Object(St.fromString)(e,{noLinkBrackets:!0,ignoreHref:!0,ignoreImage:!0,wordwrap:78}));this.$store.commit("setMessageBodyText",{uid:this.message.uid,bodyText:a}),this.replyBody=et(this.message.bodyText,this.message.from[0],this.message.dateInt)},onHtmlBodyLoaded:function(t){this.setReplyText(t),this.htmlBodyLoaded=!0},saveReplyDraft:function(t){return Object(Jt.d)(t.account,t).then(function(t){return t.uid})},sendReply:function(t){return Object(Jt.e)(t.account,t)},forwardMessage:function(){this.$router.push({name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:"new"},query:{uid:this.message.uid}})}}},te=(n(818),Object(h.a)(Xt,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppContentDetails",[t.loading?a("Loading"):t.message?[a("div",{staticClass:"section",attrs:{id:"mail-message-header"}},[a("h2",{attrs:{title:t.message.subject}},[t._v(t._s(t.message.subject))]),t._v(" "),a("p",{staticClass:"transparency"},[a("AddressList",{attrs:{entries:t.message.from}}),t._v("\n\t\t\t\tto\n\t\t\t\t"),t._v(" "),a("AddressList",{attrs:{entries:t.message.to}}),t._v(" "),t.message.cc.length?[t._v("\n\t\t\t\t\t(cc\n\t\t\t\t\t"),t._v(" "),a("AddressList",{attrs:{entries:t.message.cc}}),t._v(")\n\t\t\t\t")]:t._e()],2)]),t._v(" "),a("div",{staticClass:"mail-message-body"},[t.message.hasHtmlBody?a("MessageHTMLBody",{attrs:{url:t.htmlUrl},on:{loaded:t.onHtmlBodyLoaded}}):a("MessagePlainTextBody",{attrs:{body:t.message.body,signature:t.message.signature}}),t._v(" "),a("MessageAttachments",{attrs:{attachments:t.message.attachments}}),t._v(" "),a("div",{attrs:{id:"reply-composer"}}),t._v(" "),a("input",{attrs:{id:"forward-button",type:"button",value:t.t("mail","Forward")},on:{click:t.forwardMessage}})],1),t._v(" "),!t.message.hasHtmlBody||t.htmlBodyLoaded?a("Composer",{attrs:{"from-account":t.message.accountId,to:t.replyRecipient.to,cc:t.replyRecipient.cc,subject:t.replySubject,body:t.replyBody,"reply-to":t.replyTo,send:t.sendReply,draft:t.saveReplyDraft}}):t._e()]:a("Error",{attrs:{error:t.error&&t.error.message?t.error.message:t.t("mail","Not found"),message:t.errorMessage,data:t.error}})],2)},[],!1,null,null,null).exports),ee={name:"NewMessageDetail",components:{AppContentDetails:Q.a,Composer:bt,Error:Ct,Loading:Y},data:function(){return{loading:!1,draft:void 0,errorMessage:"",error:void 0}},computed:{composerData:function(){if(c.a.isUndefined(this.draft)){var t;if(c.a.isUndefined(this.$route.query.uid))return 0!==this.$route.params.accountId&&"0"!==this.$route.params.accountId&&(t=parseInt(this.$route.params.accountId,10)),{accountId:t,to:this.stringToRecipients(this.$route.query.to),cc:this.stringToRecipients(this.$route.query.cc),subject:this.$route.query.subject||"",body:this.$route.query.body||""};var e=this.$store.getters.getMessageByUid(this.$route.query.uid);return W.a.debug("forwaring message",e),{to:[],cc:[],subject:(a=e.subject,st.some(function(t){return a.toLowerCase().startsWith("".concat(t,":"))})?a:"FWD: ".concat(a)),body:et(e.bodyText,e.from[0],e.dateInt)}}return W.a.info("todo: handle draft data"),{to:this.draft.to,cc:this.draft.cc,bcc:this.draft.bcc,subject:this.draft.subject,body:this.draft.body};var a}},watch:{$route:function(t,e){this.draft&&"message"===t.name&&t.params.draftUid===this.draft.uid?W.a.debug("detected navigation to current (new) draft UID, not reloading"):this.fetchMessage()}},created:function(){this.fetchMessage()},methods:{stringToRecipients:function(t){return c.a.isUndefined(t)?[]:[{label:t,email:t}]},fetchMessage:function(){var e=this;this.draft=void 0,this.errorMessage="",this.error=void 0;var a=this.$route.params.draftUid;c.a.isUndefined(a)?W.a.debug("not a draft, nothing to fetch"):(this.loading=!0,this.$store.dispatch("fetchMessage",a).then(function(t){if(t.uid===e.$route.params.draftUid){if(e.draft=t,c.a.isUndefined(e.draft))return W.a.info("draft could not be found",{draftUid:a}),e.errorMessage=It(),void(e.loading=!1);e.loading=!1}else W.a.debug("User navigated away, loaded draft won't be shown")}).catch(function(n){W.a.error("could not load draft "+a,{error:n}),n.isError&&(e.errorMessage=t("mail","Could not load your draft"),e.error=n,e.loading=!1)}))},saveDraft:function(t){var e=this;return c.a.isUndefined(t.draftUID)&&this.draft&&(W.a.debug("draft data does not have a draftUID, adding one"),t.draftUID=this.draft.id),Object(Jt.d)(t.account,t).then(function(a){var n=a.uid;if(c.a.isUndefined(e.draft))return n;W.a.info("replacing draft "+e.draft.uid+" with "+n);var s={draft:e.draft,uid:n,data:t};return e.$store.dispatch("replaceDraft",s).then(function(){return e.$router.replace({name:"message",params:{accountId:e.$route.params.accountId,folderId:e.$route.params.folderId,messageUid:"new",draftUid:e.draft.uid}})}).then(function(){return n})})},sendMessage:function(t){return Object(Jt.e)(t.account,t)}}},ae=Object(h.a)(ee,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppContentDetails",[t.loading?a("Loading"):t.error?a("Error",{attrs:{error:t.error&&t.error.message?t.error.message:t.t("mail","Not found"),message:t.errorMessage,data:t.error}}):a("Composer",{attrs:{"from-account":t.composerData.accountId,to:t.composerData.to,cc:t.composerData.cc,bcc:t.composerData.bcc,subject:t.composerData.subject,body:t.composerData.body,draft:t.saveDraft,send:t.sendMessage}})],1)},[],!1,null,null,null).exports,ne={name:"NoMessageSelected",components:{AppContentDetails:Q.a},props:{mailbox:{type:String,required:!0}}},se=(n(820),Object(h.a)(ne,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppContentDetails",[a("div",{staticClass:"icon icon-mail"}),t._v(" "),a("h2",[t._v(t._s(t.mailbox))]),t._v(" "),a("p",[t._v(t._s(t.t("mail","No message selected")))])])},[],!1,null,"6b51141c",null).exports),oe={name:"FolderContent",components:{AppContent:d.a,AppDetailsToggle:f,EnvelopeList:G,Loading:Y,Message:te,NewMessageDetail:ae,NoMessageSelected:se},mixins:[m.a],props:{account:{type:Object,required:!0},folder:{type:Object,required:!0}},data:function(){return{loading:!0,searchQuery:void 0,alive:!1}},computed:{hasMessages:function(){var t=this;return this.folder.envelopes.map(function(e){return t.$store.state.envelopes[e]})},showMessage:function(){return this.hasMessages&&"message"===this.$route.name},newMessage:function(){return"new"===this.$route.params.messageUid},envelopes:function(){return c.a.isUndefined(this.searchQuery)?this.$store.getters.getEnvelopes(this.account.id,this.folder.id):this.$store.getters.getSearchEnvelopes(this.account.id,this.folder.id)}},watch:{$route:function(t,e){"folder"===t.name&&this.fetchData()}},created:function(){this.alive=!0,new OCA.Search(this.searchProxy,this.clearSearchProxy),this.fetchData()},beforeDestroy:function(){this.alive=!1},methods:{fetchData:function(){var t=this;this.loading=!0,this.$store.dispatch("fetchEnvelopes",{accountId:this.account.id,folderId:this.folder.id,query:this.searchQuery}).then(function(){var e=t.envelopes;if(W.a.debug("envelopes fetched",e),t.loading=!1,!t.isMobile&&"message"!==t.$route.name&&e.length>0){var a=e[0];t.$router.replace({name:"message",params:{accountId:t.account.id,folderId:t.folder.id,messageUid:a.uid}})}})},hideMessage:function(){this.$router.replace({name:"folder",params:{accountId:this.account.id,folderId:this.folder.id}})},searchProxy:function(t){this.alive&&this.search(t)},clearSearchProxy:function(){this.alive&&this.clearSearch()},search:function(t){this.searchQuery=t,this.fetchData()},clearSearch:function(){this.searchQuery=void 0}}},re=Object(h.a)(oe,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("AppContent",[t.showMessage?a("AppDetailsToggle",{on:{close:t.hideMessage}}):t._e(),t._v(" "),a("div",{attrs:{id:"app-content-wrapper"}},[t.loading?a("Loading",{attrs:{hint:t.t("mail","Loading messages")}}):[a("EnvelopeList",{attrs:{account:t.account,folder:t.folder,envelopes:t.envelopes,"search-query":t.searchQuery,show:!t.showMessage}}),t._v(" "),t.newMessage?a("NewMessageDetail"):t.showMessage?a("Message"):t.hasMessages?a("NoMessageSelected",{attrs:{mailbox:t.folder.name}}):t._e()]],2)],1)},[],!1,null,null,null).exports,ie={name:"Home",components:{Content:o.a,FolderContent:re,Navigation:r.a},computed:{activeAccount:function(){return this.$store.getters.getAccount(this.$route.params.accountId)},activeFolder:function(){return this.$store.getters.getFolder(this.$route.params.accountId,this.$route.params.folderId)},menu:function(){return this.buildMenu()}},created:function(){var t=this.$store.getters.getAccounts();if("home"===this.$route.name&&t.length>1){var e=t[0],a=this.$store.getters.getFolders(e.id)[0];console.debug("loading first folder of first account",e.id,a.id),this.$router.replace({name:"folder",params:{accountId:e.id,folderId:a.id}})}else if("home"===this.$route.name&&1===t.length)this.$router.replace({name:"setup"});else if("mailto"===this.$route.name){if(0===t.length)return void console.error("cannot handle mailto:, no accounts configured");var n=t[0],s=this.$store.getters.getFolders(n.id)[0];console.debug("loading composer with first account and folder",n.id,s.id),this.$router.replace({name:"message",params:{accountId:n.id,folderId:s.id,messageUid:"new"},query:{to:this.$route.query.to,cc:this.$route.query.cc,bcc:this.$route.query.bcc,subject:this.$route.query.subject,body:this.$route.query.body}})}},methods:{onNewMessage:function(){this.$router.push({name:"message",params:{accountId:this.$route.params.accountId,folderId:this.$route.params.folderId,messageUid:"new"}})}}},ce=Object(h.a)(ie,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Content",{directives:[{name:"shortkey",rawName:"v-shortkey.once",value:["c"],expression:"['c']",modifiers:{once:!0}}],attrs:{"app-name":"mail"},nativeOn:{shortkey:function(e){return t.onNewMessage(e)}}},[a("Navigation"),t._v(" "),t.activeAccount?a("FolderContent",{attrs:{account:t.activeAccount,folder:t.activeFolder}}):t._e()],1)},[],!1,null,null,null);a.default=ce.exports}}]);
//# sourceMappingURL=mail.3.c2b981da60db282fe3f8.js.map